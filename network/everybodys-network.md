# 모두의 네트워크

<br>

> 이 문서는 [<모두의 네트워크 - 미즈구치 카츠야>](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791160505030&orderClick=LAG&Kc=) 책을 보고 정리한 문서입니다.

<br>

## 1. 네트워크 첫걸음

### 1.1. 네트워크의 구조

- 컴퓨터 간의 연결을 컴퓨터 네트워크라고 함.
- 인터넷은 전 세계의 큰 네트워크부터 작은 네트워크까지 연결하는 거대한 네트워크임.
- 패킷은 컴퓨터 간의 데이터를 주고 받을 때 네트워크를 통해 흘러가는 작은 데이터 조각임.
- 큰 데이터는 작은 패킷으로 분할함.
- 패킷을 보낼 때 번호를 붙이고 패킷이 도착하면 번호순으로 정렬함.

<br>

### 1.2. 정보의 양을 나타내는 단위

- 컴퓨터는 0과 1밖에 이해하지 못함.
- 정보를 나타내는 최소 단위를 비트라고 하며, 비트 여덟 개를 1바이트라고 함.
- 숫자와 문자의 대응표를 문자 코드라고 함.

<br>

### 1.3. 랜과 왠

- 랜(LAN : Local Area Network, 근거리 통신망) : 건물 안이나 특정 지역을 범위로 하는 네트워크. 속도가 빠르고 오류가 적음.
- 왠(WAN : Wide Area Network, 광역 통신망) : ISP가 제공하는 서비스를 사용하여 구축한 네트워크. 지리적으로 넓음. 속도가 느리고 오류가 많음.
- 인터넷 서비스 제공자(ISP : Internet Service Provider) - 인터넷 상용 서비스 사업을 하고 있는 사업자. KT, U+, SK브로드밴드

<br>

### 1.4. 가정에서 하는 랜 구성

- 인터넷 서비스 제공자와 인터넷 회선을 결정하고 계약함.
- 인터넷 서비스 제공자와 네트워크를 연결하기 위해 인터넷 공유기를 사용함.
- 인터넷 공유기(Broadband Router) : 가정이나 소규모 기업에서 인터넷에 접속할 때 사용하는 가정용 라우터. 최근에는 허브, 스위칭 허브, 방화벽과 같은 다양한 기능을 제공함.
- 데스크톱 컴퓨터 한 대를 공유기와 유선으로 연결하여 ISP와 네트워크를 구성하고, 나머지는 무선으로 연결하는 경우가 많음.

<br>

### 1.5. 회사에서 하는 랜 구성

- DMZ는 외부에 공개하기 위한 네트워크임.
- 외부에 공개하는 서버에는 주로 웹 서버, DNS 서버, 메일 서버가 있음.
- 회사의 서버는 온프레미스(사내 서버)나 클라우드로 운영됨.
- 사내 서버 운영 시 서버 장비실을 두고 그곳에 랙(선반)을 설치. 랙 안에는 랙에 설치하기 적합한 형태와 크기를 가진 서버, 라우터, 스위치를 설치함.
- 각 서버나 컴퓨터는 스위치나 무선 랜 기능을 사용하여 사내 랜에 접속함.

<br>

## 2. 네트워크의 기본 규칙

### 2.1. 네트워크의 규칙

- 통신하기 위한 규칙을 프로토콜이라고 함.
- 불어를 못하는 한국인과 한국어를 못하는 프랑스인이라면 영어로 대화한다는 규칙을 정해서 대화할 수 있음.
- 편지를 배송하기 위해서는 편지를 쓸 때부터 상대방에게 도착할 때까지 지켜야 하는 독립적인 여러 규칙을 거쳐야 함.

<br>

### 2.2. OSI 모델과 TCP/IP 모델

- ISO(International Organization for Standardization, 국제표준화기구)에서 OSI 모델이라는 표준 규격을 제정함.
- OSI 모델의 7계층
  - 7계층 : 응용 계층(Application Layer, 애플리케이션 계층) : 이메일 & 파일 전송, 웹 사이트 조회 등 애플리케이션에 대한 서비스를 제공함.
  - 6계층 : 표현 계층(Presentation Layer, 프레젠테이션 계층) : 문자 코드, 압축, 암호화 등의 데이터를 변환함.
  - 5계층 : 세션 계층(Session Layer) : 세션 체결, 통신 방식을 결정함.
  - 4계층 : 전송 계층(Transport Layer, 트랜스포트 계층) : 신뢰할 수 있는 통신을 구현함.
  - 3계층 : 네트워크 계층(Network Layer) : 다른 네트워크와 통신하기 위한 경로 설정 및 논리 주소를 결정함.
  - 2계층 : 데이터 링크 계층(Data Link Layer) : 네트워크 기기 간의 데이터 전송 및 물리 주소를 결정함.
  - 1계층 : 물리 계층(Physical Layer) :시스템 간의 물리적인 연결과 전기 신호를 변환 및 제어함.

- TCP/IP 모델
  - 4계층 : 응용 계층 - OSI 7,6,5 계층
  - 3계층 : 전송 계층 - OSI 4계층
  - 2계층 : 인터넷 계층 - OSI 3계층
  - 1계층 : 네트워크 접속 계층 - OSI 2,1계층

<br>

### 2.3. 캡슐화와 역캡슐화

- 헤더 : 데이터를 보낼 때는 필요한 정보를 데이터에 추가해야 하는데 이 정보를 헤더라고 함. 헤더에는 데이터를 전달 받을 상대방에 대한 정보도 포함되어 있음.
- 트레일러 : 데이터를 전달할 때 데이터의 마지막에 추가하는 정보.
- 캡슐화 : 데이터를 상대방에게 보낼 때 각 계층에서 헤더(데이터 링크 계층의 트레일러도 포함)를 붙여 나가는 것을 캡슐화라고 함.
- 역캡슐화 : 데이터를 수신할 때 각 계층에서 헤더(데이터 링크 계층의 트레일러도 포함)를 제거해 나가는 것을 역캡슐화라고 함.
- OSI 모델에서 데이터 송신 측은 응용 계층 -> 전송 계층 -> 네트워크 계층 -> 데이터 링크 계층 순서로 캡슐화함.
- OSI 모델에서 데이터 수신 측은 데이터 링크 계층 -> 네트워크 계층 -> 전송 계층 -> 응용 계층 순서로 역캡슐화함.
- 송신 측의 데이터 링크 계층에서 만들어진 데이터가 전기 신호로 변환되어 수신 측에 전송됨.

<br>

## 3. 물리 계층 : 데이터를 전기 신호로 변환하기

### 3.1. 물리 계층의 역할과 랜 카드의 구조

- 전기 신호에는 아날로그 신호와 디지털 신호가 있음.
- 아날로그 신호는 전화 회선이나 라디오 방송에 사용되는 신호임.
- 네트워크를 통해 상대방에게 데이터를 전송할 때 0과 1의 비트열은 전기 신호로 변환되어 전송됨. 상대방이 받은 전기 신호는 다시 0과 1의 비트열로 복원됨.
- 컴퓨터는 네트워크를 통해 데이터를 송수신할 수 있도록 랜 카드가 메인 보드에 포함되어 있는 내장형 랜 카드나 별도의 랜 카드를 가지고 있음. 0과 1의 정보가 컴퓨터 내부에 있는 랜 카드로 전송되고 랜 카드는 0과 1을 전기 신호로 변환함.
- 물리 계층은 컴퓨터와 네트워크 장비 간에 전송되는 데이터를 전기 신호로 변환하는 계층임.

<br>

### 3.2. 케이블의 종류와 구조

- 트위스트 페어 케이블(twisted pair cable) : 구리 선 여덟 개를 두 개씩 꼬아 만든 네 쌍의 전선.
  - UTP(Unshielded Twisted Pair) 케이블 : 실드(shield)로 보호되어 있지 않은 케이블. 노이즈의 영향을 쉽게 받음. 가격이 저렴하여 일반적으로 많이 사용됨.
  - STP(Shielded Twisted Pair) 케이블 : 실드로 보호한 케이블. 노이즈의 영향을 적게 받음. 가격이 비싸 보편적으로 사용하지는 않음.
- UTP 케이블의 분류
  - Cat3 - 속도10Mbps
  - Cat5 - 속도 100Mbps
  - Cat5e - 속도 1000Mbps
  - Cat6 - 속도 1000Mbps
  - Cat6a - 속도 10GMbps
  - Cat7 - 속도 10GMbps

- 트위스트 페어 케이블은 일반적으로 랜 케이블이라고 부름.
- 랜 케이블의 양쪽 끝에는 RJ-45라는 커넥터가 달려 있음.
- 랜 케이블의 종류
  - 다이렉트 케이블 : 구리 선 여덟 개를 같은 순서로 커넥터에 연결한 케이블. 컴퓨터와 스위치를 연결할 때 사용함.
  - 크로스 케이블 : 구리 선 여덟 개 중 한쪽 커넥터의 1번과 2번에 연결되는 구리 선을 다른 쪽 커넥터의 3번과 6번에 연결한 케이블. 컴퓨터 간에 직접 랜 케이블로 연결할 때 사용함.
  - 두 케이블 모두 실제로는 1번, 2번, 3번, 6번 구리 선을 사용하고 나머지 선 네 개는 사용하지 않음.

<br>

### 3.3. 리피터와 허브의 구조

- 리피터 : 전기 신호를 정형(일그러진 전기 신호를 복원)하고 증폭하는 기능을 가진 네트워크 중계 장비. 통신하는 상대방이 멀리 있을 때 리피터를 사이에 넣음. 최근에는 다른 네트워크 장비가 리피터 기능을 지원하기 때문에 사용하지 않음.
- 허브 : 포트(실제로 통신하는 통로)를 여러 개 가지고 있고 리피터 허브라고도 불림. 리피터는 일대일 통신만 가능하지만 허브는 포트를 여러 개 가지고 있어서 컴퓨터 여러 대와도 통신할 수 있음.
- 허브도 리피터와 마찬가지로 전기 신호를 정형하고 증폭하는기능을 함. 컴퓨터에서 보낸 전기 신호가 노이즈의 영향으로 파형이 될 때 허브가 파형을 정상으로 되돌리는 기능을 함.
- 허브는 어떤 특정 포트로부터 데이터를 받을 때 해당 포트를 제외한 나머지 모든 포트로 받은 데이터를 전송함. 허브는 스스로 판단하지 않고, 전기 신호를 모든 포트로 보내서 더미 허브(dummy hub)라고도 불림.

<br>

## 4. 데이터 링크 계층 : 랜에서 데이터 전송하기

### 4.1. 데이터 링크 계층의 역할과 이더넷

- 데이터 링크 계층은 네트워크 장비 간에 신호를 주고받는 규칙을 정하는 계층으로, 랜에서 데이터를 정상적으로 주고받기 위해 필요한 계층.
- 이더넷은 랜에서 데이터를 정상으로 주고받기 위한 규칙임.
- 허브는 모든 포트로 데이터를 전송하기 때문에 데이터 충돌이 발생할 수 있음.
- 이더넷에서 데이터 충돌을 피하기 위해 데이터 전송 시점을 늦추는 방법을 CSMA/CD라고 함.
- CSMA/CD(Carrier Sense Multiple Access with Collision Detection, 반송파 감지 다중 접속 및 충돌 탐지)
  - CS : 데이터를 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 아닌지를 확인하는 규칙.
  - MA : 케이블에 데이터가 흐르고 있지 않으면 데이터를 보내도 된다는 규칙.
  - CD : 충돌이 발생하고 있는지 확인하는 규칙.
- 현재는 효율이 좋지 않아 CSMA/CD는 거의 사용하지 않음. 스위치를 사용하면 데이터 충돌이 일어나지 않음.

<br>

### 4.2. MAC 주소의 구조

- MAC 주소(Media Access Control Address, 물리 주소)
  - 랜 카드 제조시 새겨지는 유일한 번호.
  - MAC 주소는 48비트 숫자로 구성. 앞쪽 24비트는 랜 카드를 만든 제조사 번호, 뒤쪽 24비트는 제조사가 붙인 일련번호로 구성됨.
- OSI 모델 데이터 링크 계층, TCP/IP 모델 네트워크 계층에서 이더넷 헤더와 트레일러를 붙임.
  - 이더넷 헤더는 목적지의 MAC 주소(6바이트), 출발지 MAC 주소(6바이트), 유형(2바이트) 총 14바이트로 구성됨. 유형에는 프로토콜 종류를 식별하는 번호가 들어감.(IPv4, IPv6 등)
  - 트레일러는 FCS(Frame Check Sequence)라고도 함. 데이터 전송 도중에 오류가 발생하는지 확인하는 용도로 사용함.
- 이더넷 헤더와 트레일러가 추가된 데이터를 프레임이라고 함.
- 허브의 각각의 포트들은 목적지 MAC 주소가 자신의 MAC 주소와 같은지 확인하고 같을 경우 데이터를 수신하고, 다를 경우 데이터를 파기함.

<br>

### 4.3. 스위치의 구조

- 스위치(switch)
  - 데이터 링크 계층에서 동작.
  - 레이어 2 스위치, 스위칭 허브라고도 부름.
  - 장비 외형은 허브와 비슷함.
  - 스위치 내부에는 MAC 주소 테이블이 있음.
- MAC 주소 테이블
  - 브리지 테이블(bridge table)이라고도 함.
  - 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스.
  - MAC 주소 학습 기능이 있음. 프레임 데이터 전송 시 MAC 주소 테이블을 확인하고 MAC 주소가 등록되어 있지 않으면 MAC 주소를 포트와 함께 등록함.
  - 플러딩(flooding) : MAC 주소 테이블에 목적지 MAC 주소 등록 안되어 있을 때는 허브처럼 모든 포트에 데이터 전송함.
  - MAC 주소 필터링 : 스위치에서 MAC 주소를 기준으로 출발지를 선택하는 것.

<br>

### 4.4. 데이터가 케이블에서 충돌하지 않는 구조

- 전이중 통신 방식
  - 데이터의 송수신을 동시에 통신하는 방식.
  - 컴퓨터 두 대를 크로스 케이블을 사용하여 연결하는 방식이 전이중 통신 방식임.
  - 스위치도 전이중 통신 방식으로 데이터를 주고 받음.
- 반이중 통신 방식
  - 회선 하나로 송신과 수신을 번갈아가면서 통신하는 방식.
  - 허브 내부에는 송수신이 나눠져 있지 않아 허브를 사용하면 회선 하나를 송신과 수신이 번갈아가면서 사용하는 반이중 통신 방식을 사용하게 됨.
  - 허브를 사용하면 충돌이 생기면서 네트워크 지연이 발생하기 때문에 최근에는 네트워크로 스위치를 이용하는 것이 표준임.
- 충돌 도메인(collision domain)
  - 충돌이 발생할 때 그 영향이 미치는 범위.
  - 허브는 모든 컴퓨터에 충돌의 영향이 미치기 때문에 접속되어 있는 모든 컴퓨터가 충돌 도메인이 됨.
  - 스위치는 충돌 도메인의 범위가 1대로 적음.
  - 충돌 도메인의 범위가 넓을수록 네트워크가 지연됨.
- 주소 결정 프로토콜(ARP : Address Resolution Protocol)
  - IP주소를 MAC 주소에 매칭시키기 위한 프로토콜.
  - 출발지 컴퓨터가 목적지의 주소를 모를 때 MAC 주소를 알아내기 위해 네트워크에 브로드캐스트를 하는데 이것을 'ARP 요청(request)'이라고 함.
  - 지정된 IP주소를 가진 컴퓨터는 MAC 주소를 응답으로 보냄. 이것을 'ARP 응답(reply)'이라고 함.
  - 출발지 컴퓨터는 MAC 주소와 IP 주소의 매핑 정보를 메모리에 보관함. 이 정보를 'ARP 테이블(table)'이라고 함.
  - ARP 테이블에는 보존 기간을 ARP 캐시로 지정하고 일정 시간이 지나면 삭제하고 다시 ARP 요청을 함.
  - ARP 요청이 가능한 범위를 LAN 범위로 보기도 함.

<br>

### 4.5. 이더넷의 종류와 특징

- 이더넷은 케이블 종류나 통신 속도에 따라 다양한 규격으로 분류됨
- 주요 이더넷 규격
  - 10BASE5
  - 10BASE2
  - 10BASE-T
  - 100BASE-TX
  - 1000BASE-T
  - 10GBASE-T
- BASE의 왼쪽 숫자는 통신 속도를 나타냄.
- BASE는 전송 방식을 나타냄.
- 제일 뒤 T는 케이블 종류를 말함.
- 제일 뒤 하이픈(-) 없는 숫자는 동축케이블 길이 나타냄 5는 500미터.
- 최근 컴퓨터의 랜 포트는 1000BASE-T가 일반적임. 조금씩 10GBASE-T도 많아지고 있음.

<br>

## 5. 네트워크 계층 : 목적지에 데이터 전달하기

### 5.1. 네트워크 계층의 역할

- OSI 모델의 네트워크 계층
  - 서로 다른 네트워크에 있는 목적지로 데이터를 전송하기 위해 필요함.
  - 네트워크 간의 통신을 가능하게 하는 것이 네트워크 계층의 역할.
- 라우터(router)
  - 다른 네트워크로 데이터를 전송하기 위해 필요한 네트워크 장비.
  - 데이터의 목적지가 정해지면 해당 목적지까지 어떤 경로로 가는 것이 좋은지를 알려 주는 기능을 함.
  - 다른 네트워크에 있는 목적지를 지정하기 위해서는 IP 주소가 필요함.
  - 목적지 IP 주소까지 어떤 경로로 데이터를 보낼지 결정하는 것을 라우팅(routing)이라고 함.
  - 라우터에는 라우팅 테이블(routing table)이 있어서 경로 정보를 등록하고 관리함.
- IP(Internet Protocol)

- IP 주소
  - 네트워크를 식별할 수 있는 주소.
  - 어떤 네트워크의 어떤 컴퓨터인지를 구분할 수 있도록 하는 주소.
- IP 헤더
  - 네트워크 계층에서 데이터를 캡슐화할 때 붙이는 것.
  - 데이터를 정확하게 전달하기 위해 필요한 정보가 포함되어 있음.
  - 1) 버전
    2) 헤더 길이
    3) 서비스 유형
    4) 전체 패킷 길이
    5) ID
    6) 조각 상태
    7) 조각의 위치
    8) TTL
    9) 프로토콜
    10) 헤더 체크섬
    11) 출발지 IP 주소
    12) 목적지 IP 주소
- IP 패킷
  - IP 프로토콜을 사용하여 캡슐화한 데이터.
  - 데이터 링크 계층에서 프레임이라고 부르던 것에 IP헤더가 추가된 것.

<br>

### 5.2. IP 주소의 구조

- IP 주소는 인터넷 서비스 제공자(ISP)에게 받을 수 있음.
- IP 버전
  - IPv4 : 32비트. IP 주소 약 43억 개 만들 수 있음.
  - IPv6 : 128비트. IPv4보다 많은 IP 주소 만들 수 있음.
- IP 주소 종류
  - 공인 IP 주소 : 인터넷에 직접 연결되는 컴퓨터나 라어투에 할당되는 IP 주소.
  - 사설 IP 주소 : 회사나 가정의 랜에 있는 컴퓨터에 할당되는 IP 주소.
- DHCP(Dynamic Host Configuration Protocol)
  - IP 주소를 자동으로 할당하는 프로토콜
  - ISP가 제공하는 공인 IP 주소는 라우터에만 할당하고 랜 안에 있는 컴퓨터들에는 랜의 네트워크 관리자가 자유롭게 사설 IP 주소를 할당하거나 라우터의 DHCP 기능을 사용하여 주소를 자동으로 할당하고 있음.
- IP 주소 구성
  - 네트워크 ID : 어떤 네트워크인지를 나타냄.
  - 호스트 ID : 해당 네트워크의 어느 컴퓨터인지를 나타냄.

<br>

### 5.3. IP 주소의 클래스 구조

- IP 주소 클래스의 종류
  - A 클래스 - 대규모 네트워크 주소
    - 네트워크 ID : 처음 8비트
    - 호스트 ID : 다음 24비트
  - B 클래스 - 중형 네트워크 주소
    - 네트워크 ID : 처음 16비트
    - 호스트 ID : 다음 16비트
  - C 클래스 - 소규모 네트워크 주소
    - 네트워크 ID : 처음 24비트
    - 호스트 ID : 다음 8비트
  - D 클래스 - 멀티캐스트(multicast) 주소
  - E 클래스 - 연구 및 특수용도 주소
- 클래스별 공인 IP 주소의 범위
  - A 클래스
    - 1.0.0.0 ~ 9.255.255.255
    - 11.0.0.0 ~ 126.255.255.255
  - B 클래스
    - 128.0.0.0 ~ 172.15.255.255
    - 172.32.0.0 ~ 191.255.255.255
  - C 클래스
    - 192.0.0.0 ~ 192.167.255.255
    - 192.169.0.0 ~ 223.255.255.255
- 클래스별 사설 IP 주소의 범위
  - A 클래스
    - 10.0.0.0 ~ 10.255.255.255
  - B 클래스
    - 172.16.0.0 ~ 172.31.255.255
  - C 클래스
    - 192.168.0.0 ~ 192.168.255.255

<br>

### 5.4. 네트워크 주소와 브로드캐스트 주소의 구조

- 네트워크 주소
  - 네트워크 대표 주소.
  - 호스트 ID가 10진수로 0이고, 2진수로 00000000인 주소.
  - 전체 네트워크에서 작은 네트워크를 식별하는 데 사용됨.
  - 호스트 ID가 0이면 그 네트워크 전체를 대표하는 주소가 됨.
- 브로드캐스트 주소
  - 호스트 ID가 10진수로 255이고, 2진수로 11111111인 주소.
  - 네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송하는 데 사용되는 전용 IP 주소.
  - 호스트 ID에 255를 설정하고 데이터를 전송하면 네트워크 안에 있는 모든 컴퓨터가 데이터를 받게 됨.

- 네트워크 주소와 브로드캐스트 주소는 컴퓨터나 라우터가 자신의 IP로 사용하면 안 됨.

<br>

### 5.5. 서브넷의 구조

- 서브넷(subnet)
  - 대규모 네트워크를 작은 네트워크로 분할하는 것을 서브넷팅(subneting)이라고 하고, 분할된 네트워크를 서브넷이라고 함.
  - 서브넷팅으로 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있음.
  - 더 많은 네트워크를 만들 수 있어서 IP 주소를 덮효과적으로 활용할 수 있음.
  - A 클래스의 기존 호스트 ID 24비트 중 10비트를 서브넷 ID 용으로 사용함.
- 서브넷 마스크
  - 네트워크 ID와 호스트 ID를 식별하기 위한 값.
  - 32비트의 숫자로 1비트는 네트워크 부분, 0비트는 호스트 부분을 나타냄.
  - A클래스 255.0.0.0 B클래스 255.255.0.0 C클래스 255.255.255.0
  - 프리픽스 표기법 : 서브넷 마스크를 슬래시(/비트수)로 나타낸 것.
  - 예시 : C클래스에서 서브넷ID 4비트 사용 -> 네트워크 ID와 서브넷 ID가 28비트가 되어 프리픽스 표기법으로 /28됨.

<br>

### 5.6. 라우터의 구조

- 서로 다른 네트워크와 통신하려면 라우터가 필요함.
- 라우터는 네트워크를 분할할 수 있지만 스위치와 허브는 분할할 수 없음.
- 컴퓨터에서 다른 네트워크로 데이터를 전송하려면 기본 게이트웨이를 설정해야 함.

- 기본 게이트웨이(default gateway)
  - 라우터에 설정된 IP 주소.
  - 네트워크의 출입구 역할을 함.
- 라우팅(routing)
  - 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송하는 방식.
  - 경로 정보가 등록되어 있는 테이블을 라우팅 테이블이라고 함.
- 라우팅 테이블 등록
  - 네트워크 관리자가 수동으로 등록 가능. 소규모 네트워크에 적합함.
  - 자동으로 등록 가능. 대규모 네트워크에 적합함.
- 라우팅 프로토콜
  - 라우터 간에 라우팅 정보를 교환하기 위한 프로토콜.
  - RIP, OSPF, BGP 등이 있음.

<br>

## 6. 전송 계층 : 신뢰할 수 있는 데이터 전달하기

### 6.1. 전송 계층의 역할

- 전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요함.
- 전송 계층의 두 가지 역할
  - 전송 계층에는 오류를 점검하는 기능이 있음.
  - 전송 계층에서는 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능이 있음.
- 연결형 통신
  - 상대방과 확인해 가면서 통신하는 방식.
  - 신뢰할 수 있고 정확한 데이터를 전달할 수 있음.
  - 전송 계층의 연결형 통신 프로토콜에는 TCP(Transmission Control Protocol, 전송 제어 프로토콜)가 사용됨.
- 비연결형 통신
  - 상대방을 확인하지 않고 일방적으로 데이터를 전송하는 방식.
  - 신뢰성과 정확성보다 효율성을 우선하는 통신.
  - 동영상 볼 때 사용함.
  - 비연결형 통신 프로토콜에는 UDP(User Datagram Protocol, 사용자 데이터그램 프로토콜)가 사용됨.

<br>

### 6.2. TCP의 구조

- TCP 헤더 : 전송 계층에서 TCP로 전송할 때 붙이는 헤더.
- 세그먼트(segment) : TCP 헤더가 붙은 데이터.
- TCP 헤더 정보
  - 1. 출발지 포트 번호(16비트)
    2. 목적지 포트 번호(16비트)
    3. 일련번호(32비트)
    4. 확인 응답 번호(32비트)
    5. 헤더 길이(4비트)
    6. 예약 영역(6비트)
    7. 코드 비트(6비트)
    8. 윈도우 크기(16비트)
    9. 체크섬(16비트)
    10. 긴급 포인터(16비트)
    11. 옵션
- 연결형 통신은 데이터를 전송하려면 먼저 연결(connection)이라는 가상의 독점 통신로를 확보해야 함.
  - 연결 : TCP 통신에서 정보를 전달하기 위해 사용되는 가상의 통신로로 연결을 확립하고 데이터를 전송함.
  - 연결이 확립되려면 TCP 헤더의 코드 비트 6비트 중 5번째인 SYN(씬), 2번째인 ACK(애크) 부분이 1로 활성화되어야 함.
  - SYN은 연결 요청, ACK는 확인 응답을 뜻함.
- 3-way 핸드셰이크(three-way handshake)
  - 데이터를 보내기 전에 연결을 확립하기 위해 패킷 요청을 세 번 교환하는 것.
  - 1. -> 연결 확립 요청(SYN) - 000010
    2. <- 연결 확립 응답(SYN) + 연결 확립 요청(ACK) - 010010
    3. -> 연결 확립 응답(ACK) - 010000
- 4-way 핸드셰이크(four-way handshake)
  - 연결을 종료하기 위해 패킷 요청을 네 번 교환하는 것.
  - 1. -> 연결 종료 요청(FIN) - 000001
    2. <- 연결 종료 응답(ACK) - 010000
    3. <- 연결 종료 요청(FIN) - 000001
    4. 0> 연결 종료 응답(ACK) - 010000

<br>

### 6.3. 일련번호와 확인 응답 번호의 구조

- 연결 확립 후 실제 데이터를 보내거나 상대방이 받을 때는 TCP 헤더의 일련번호(sequence number)와 확인 응답 번호(acknowledgement number)를 사용함.
  - 일련번호는 송신 측에서 수신 측에 '이 데이터가 몇 번째 데이터인지' 알려 주는 역할을 함.
  - 확인응답번호는 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할을  함. 이 번호는 다음 번호의 데이터를 요청하는 데도 사용됨.
  - 확인응답 : 데이터 수신 후 다음 데이터를 송신 측에 요청하는 것.

-  재전송 제어 : 데이터가 항상 올바르게 전달되는 것은 아니므로 일련번호와 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우에 데이터를 재전송하는 것.
- 버퍼 : 상대에게 받은 세그먼트(데이터)를 일시적으로 보관하는 장소.
- 오버플로우 : 수신 측에 대량의 데이터가 전송되어 버퍼에 보관하지 못하고 넘쳐 버린 것.
- TCP 헤더의 윈도우 크기(window size)값으로 버퍼의 한계 크기 데이터를 저장하여 상대에게 알려줌.
- 윈도우 크기 : 확인 응답을 일일이 하지 않고 연속해서 송수신할 수 있는 데이터 크기. 3-way 핸드셰이크를 할 때 서로의 윈도우 크기를 확인함.
- 송신 측에서 수신 측의 윈도우 크기를 가지고 있다면 확인 응답을 받지 않고도 세그먼트(데이터)를 연속적으로 전송할 수 있음.
- 이러한 기능들을 연결 확립, 재전송 제어, 윈도우 제어라고 함.

<br>

### 6.4. 포트 번호의 구조

- 포트 번호(port number)
- TCP 헤더의 출발지 포트 번호(source port number)와 목적지 포트 번호(destination port number)
- TCP는 포트 번호로 애플리케이션을 확인함.
- 포트 번호는 0~65535번을 사용할 수 있음.
  - 잘 알려진 포트(well-known ports) : 0~1023번 포트는 주요 프로토콜이 사용하도록 예약되어 있음.
  - 랜덤 포트 : 1025번 이상 포트. 1024번은 예약되어 있지만 사용되지는 않는 포트임.
- 서버에 주로 사용되는 애플리케이션 포트 번호
  - SSH : 22번
  - SMTP : 25번
  - DNS : 53번
  - HTTP : 80번
  - POP3 : 110번
  - HTTPS : 443번

- 클라이언트 측의 포트 번호는 접속 시 자동으로 할당됨. 1025번 ~ 65535번

<br>

### 6.5. UDP의 구조

- UDP
  - 효율성을 중요하게 여기는 프로토콜
  - 비연결형 통신에 사용됨. 상대방을 확인하지 않고 연속해서 데이터를 보냄.
  - 데이터를 효율적으로 빠르게 보낼 수 있음.
  - 스트리밍 방식으로 전송하는 동영상 서비스 등에 사용됨.
- UDP는 UDP 헤더가 있음. TCP 헤더에 비해 간단함.

- UDP 헤더가 붙은 데이터를 UDP 데이터그램이라고 함.
- 브로드캐스트(broadcast) : 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보내는 것.
- UDP는 랜에서 불특정 다수에게 브로드캐스트로 데이터를 일괄 전송함.

<br>

## 7. 응용 계층 : 애플리케이션에 데이터 전송하기

### 7.1. 응용 계층의 역할

- 응용 계층 : 애플리케이션이 동작하는 계층.
- 서비스 : 네트워크나 애플리케이션이 제공하는 기능이나 동작, 정보.
- 클라이언트 : 서비스를 요청하는 측. 사용자.
- 서버 : 서비스를 제공하는 측.
- 클라이언트 측 애플리케이션이 서버 측 애플리케이션과 통신하려면 응용 계층의 프로토콜을 사용해야 함.
  - HTTP : 웹 사이트 접속 시, Hyper Text Transfer Protocol
  - FTP : 파일 전송 시, File Transfer Protocol
  - SMTP : 메일 송신 시, Simple Mail Transfer Protocol
  - POP3 : 메일 수신 시, Post Office Protocol version3
  - DNS : 이름 해석 시, Domain Name System
    - 이름 해석(name resolution) : 네트워크에서 컴퓨터나 네트워크 장비에 붙여진 이름을 기반으로 IP 주소를 알아내는 것.

<br>

### 7.2. 웹 서버의 구조(웹 사이트 접속)

- 웹 서버에서 웹 브라우저로 전송되는 html 파일과 이미지 파일은 서버 측에 요청 시 각각 별도로 요청함. 가끔 글이 먼저 보이고 이미지가 나중에 보일 때가 있는데 위의 이유 때문임.
- 클라이언트에서 80번 포트를 통해 HTTP 요청(request)을 보내고 서버에서 HTTP 응답(response)을 반환함.
  - 클라이언트가 데이터를 요청할 때는 "GET"이라고 하는 요청 정보, 파일 이름, 버전 등을 서버에 전송함.
  - 서버는 응답으로 요청을 정상적으로 처리했다는 "OK"라는 정보를 반환하고 index.html을 클라이언트에게 보냄.
- HTTP/1.0 버전에서는 요청을 보낼 때마다 연결했다 끊는 작업을 반복해서 속도가 느렸음.
- HTTP/1.1 버전에서는 keepalive라는 기능이 추가됨. 연결을 한 번 수립하면 데이터 교환을 마칠 때까지 유지하고, 데이터 교환을 모두 끝내면 연결을 끊는 구조.
- HTTP/2.0 버전에서는 요청을 보낸 순서대로 응답 반환하지 않아도 됨. 콘텐츠를 빠르게 표시할 수 있음.

<br>

### 7.3. DNS 서버의 구조(이름 해석)

- DNS는 문자로 된 URL을 숫자로 된 IP 주소로 변환하는 서비스(시스템).
- DNS의 도메인 이름을 IP 주소로 변환하는 기능을 이름 해석(name resolution)이라고 함.
- http://www.google.co.kr에 접속하면 DNS 서버가 이 웹 사이트 서버의 IP 주소를 알려줌.
- 도메인 이름 : 컴퓨터나 네트워크를 식별하기 위해 붙여진 이름
- 호스트 이름(서버 이름) : 도메인 이름 앞에 있는 www.
- 처음에는 웹 사이트의 IP 주소를 모르기 때문에 먼저 DNS 서버에 요청하여 IP 주소를 확인하고 웹 서버에 접속함.
- DNS 서버는 요청 받은 도메인의 IP 주소를 모르면 다른 DNS 서버에 질의함.
- DNS 서버는 전 세계에 흩어져 있고 모두 계층적으로 연결되어 있음.

<br>

### 7.4. 메일 서버의 구조(SMTP와 POP3)

- SMTP : 메일을 보내는 데 사용되는 프로토콜. 25번 포트 번호 사용함.
- POP3 : 메일을 받는 데 사용되는 프로토콜. 110번 포트 번호 사용함.
- SMTP는 메일 서버 간의 메일 전송에도 이용됨.
- 컴퓨터1 -> 메일 서버1 -> 메일 서버2 -> 컴퓨터2
- SMTP에 의한 메일 송신
  - 세션 시작 통지
  - 송신자 메일 주소 통지
  - 목적지 메일 주소 통지
  - 메일 본문 전송 통지
  - 메일 본문 송신
  - 세션 종료 통지
- 메일 박스 : 메일 서버에서 메일을 보관해 주는 기능.
- 메일 서버는 POP3을 사용하여 메일 서버의 메일 박스에서 메일을 가져와서 컴퓨터로 전송함.
- POP3에 의한 메일 수신
  - 세션 시작 통지
  - 수신자의 사용자 이름 통지
  - 수신자의 비밀번호 통지
  - 메일 확인
  - 메일의 전송을 요청
  - 세션 종료 통지

<br>

## 8. 네트워크의 전체 흐름 살펴보기

### 8.1. 랜 카드에서의 데이터 전달과 처리

- 컴퓨터에서 데이터 링크 계층까지의 캡슐화 흐름
  - 컴퓨터 : 웹 브라우저에 URL을 입력하여 접속
  - 응용 계층 : 'GET/index.html HTTP/1.1 ~'과 같은 HTTP 메시지 전송
  - 전송 계층 : 출발지, 목적지 포트 번호 등이 기록된 TCP 헤더를 붙여 세그먼트 전송
  - 네트워크 계층 : 출발지, 목적지 IP 주소 등이 기록된 IP 헤더를 붙여 IP 패킷 전송
  - 데이터 링크 계층 : 이더넷 헤더와 트레일러 붙여 이더넷 프레임 전송
  - 물리 계층 : 전기 신호로 변환되어 네트워크로 전송

<br>

### 8.2. 스위치와 라우터에서의 데이터 전달과 처리

- 스위치A (클라이언트)
  - 데이터 링크 계층에서 데이터를 전기 신호로 변환.
  - 물리 계층을 통해 라우터로 전송함.

- 라우터A (클라이언트)

  - 역캡슐화 시작.
    - 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소 비교.
    - 주소가 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화 수행.
    - 네트워크 계층에 전달.
    - 네트워크 계층에서 자신의 라우팅 테이블과 목적지 IP 주소 비교.
  - 다시 캡슐화(라우팅)
    - 네트워크 계층에서 현재 출발지 IP 주소를 라우터의 외부 IP 주소(실제로는 왠(WAN) 측)로 변경.
    - 데이터 링크 계층에서 서버 라우터로 보내지도록 이더넷 헤더와 트레일러를 붙임.
    - 물리 계층에서 데이터를 전기 신호로 변환하여 네트워크로 전달함.

- 라우터B (서버)

  - 역캡슐화

    - 물리 계층 전기 신호로 변환되어 케이블 통해 데이터 라우터B에 도착.

    - 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소 비교.
    - 주소 같으면 이더넷 헤더와 트레일러를 분리하는 역캡슐화를 수행.
    - 네트워크 계층으로 전달.
    - 네트워크 계층에서 자신의 라우팅 테이블과 목적지 IP 주소를 비교.

  - 캡슐화

    - 네트워크 계층에서 출발지 IP 주소를 라우터 B의 내부 IP 주소(실제 랜(LAN) 측)로 변경함.
    - 데이터 링크 계층으로 전달
    - 데이터 링크 계층에서 이더넷 헤더와 트레일러를 붙인 후 물리 계층으로 전달.
    - 물리 계층에서 데이터를 전기 신호로 변환하여 스위치 B로 전달.

- 스위치B (서버)

  - 역캡슐화
    - 데이터 링크 계층에서 처리하고 웹 서버에 데이터를 전기 신호로 전달함.

<br>

### 8.3. 웹 서버에서의 데이터 전달과 처리

- 웹 서버에서의 데이터 전달과 처리
  - 물리 계층에서 데이터가 전기 신호로 웹 서버에 도착.
  - 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC 주소와 자신의 MAC 주소 비교.
  - 주소가 같으면 이더넷 헤더와 트레일러를 분리하고 네트워크 계층에 전달.
  - 네트워크 계층에서 목적지 IP 주소와 웹 서버의 IP 주소 같은지 확인.
  - 주소가 같으면 IP 헤더를 분리하고 전송 계층에 전달.
  - 전송 계층에서 목적지 포트 번호를 확인하여 어떤 애플리케이션으로 전달해야 되는지 판단.
  - TCP 헤더를 분리하여 응용 계층에 전달하여 데이터 응용 계층 도착.

- 라우팅
  - 라우팅은 패킷을 목적지 컴퓨터까지 보낼 때 최적의 경로를 선택하여 전송하는 것을 뜻함.
  - 정적 라우팅
    - 관리자가 미리 라우팅 테이블에 경로를 수동으로 추가흔ㄴ 방법.
    - 목적지까지의 경로를 고정하거나 목적지까지의 경로가 하나로 한정되는 경우에 사용함.
    - 소규모 네트워크에서 사용함.
    - 라우팅 정보가 교환되지 않아 대역폭에 대한 부담이 적고, 보안을 유지하기 좋다는 장점이 있음.
    - 어떤 경로에 장애가 발생해도 다른 경로로 우회할 수 없다는 단점이 있음. 이럴 때는 관리자가 설정을 하나하나 변경해야 해서 번거로움.
  - 동적 라우팅
    - 네트워크 변경을 자동으로 감지하여 라우팅 테이블을 업데이트하거나 네트워크 장애가 발생했을 때 라우터끼리 정보를 교환하여 최적의 경로로 전환하는 기능을 함.
    - 대규모 네트워크에 적합함.

<br>

## 9. 무선 랜 이해하기

### 9.1. 무선 랜의 구조

- 무선 랜의 장점
  - 케이블이 엉키거나 걸리적거리지 않아 편함.
  - 물리적으로 단절된 공간에서 서로 통신할 수 있음.
- 무선 랜의 단점
  - 유선보다 속도가 불안정함.
  - 전파가 약하면 연결이 잘 안 됨.
  - 유선보다 해킹될 위험이 더 높음.
- 무선 액세스 포인트(Wireless Access Point, WAP) + 무선 클라이언트(컴퓨터나 스마트폰 등)
- 컴퓨터가 무선 액세스 포인트와 통신하려면 무선 랜 칩과 무선 랜 어댑터가 필요함. 최근 컴퓨터는 무선 랜 칩을 대부분 내장하고 있음.
- 무선 랜 어댑터는 USB 포트에 꽂아 사용하는 USB 메모리 방식 어댑터와 컴퓨터 카드 방식 어댑터가 있음.
- 무선 랜 연결하는 방식
  - 인프라스트럭처(infrastructure) : 무선 액세스 포인트를 통해 통신하는 방식.
  - 애드혹(Ad Hoc) : 무선 클라이언트끼리 직접 통신하는 방식.
  - 주로 인프라스트럭처 방식을 사용함.
- 무선 랜 규격
  - IEEE802.11
  - 11n 또는 11ac를 주로 사용함.
  - 무선 공유기에 통신 '규격 : IEEE802.11ac/n/g/n/a'라고 쓰여 있다면 다섯 개 규격을 모두 지원한다는 뜻.
- 무선 액세스 포인트 = 무선 공유기 = 무선 AP

<br>

### 9.2. SSID의 구조

- 무선 액세스 포인트와 무선 클라이언트를 연결하려면 SSID라는 네트워크 이름, 인증, 암호화, 암호화 키를 설정해야 함.
  - SSID(Service set IDentifier) : 액세스 포인트의 고유 이름.
- 무선 액세스 포인트와 무선 클라이언트의 연결 과정
  - -> 비컨 전송
  - <- 같은 SSID인지 문의
  - -> 같은 SSID라고 응답
  - <-> 인증
  - <- 접속 요구
  - -> 승인 응답
- 비컨(beacon) : 무선 공유기가 자신을 알리는 신호를 네트워크에 있는 모든 기기에 주기적으로 전송. 무선 클라이언트는 이 신호를 잡아서 연결함.
- 채널 : 무선 랜은 여러 기기를 동시에 연결할 수 있도록 주파수 대역을 분할하는데, 그 주파수 대역을 채널이라고 함.
- 무선 공유기가 2대 이상일 때 각각 다른 채널을 설정해야 함. 전파는 겹치지만 주파수가 겹치지 않아 서로 간섭이 일어나지 않아 통신 속도가 떨어지지 않음.
- 전파가 겹치는 무선 공유기들이 같은 채널로 설정되어 있음녀 주파수가 서로 겹치면서 전파 간섭이 생기고 통신 속도가 느려짐.
- 규격에 따라 서로 다른 채널을 사용하더라도 일부에서 같은 주파수를 사용해 간섭이 생기기도 함. 11b, 11g는 간섭이 생김. 11a는 간섭이 안 생김.

<br>

# References

- [모두의 네트워크 / 미즈구치 카츠야 / 이승룡 옮김 / 길벗 / 2018](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791160505030&orderClick=LAG&Kc=)

<br>
